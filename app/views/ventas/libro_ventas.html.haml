- title "Libro de Ventas"

%p Aquí van un select :mes, :año

%br
%table.libro_de_ventas{:border => 1, :cellpadding => 16, :rules => 'cols', :frame => 'vsides'}
  %tr
    %th Días
    %th
      Boletas
      %br
      del N°
    %th
      Boletas
      %br
      al N°
    %th
      Ventas
      %br
      con Boleta
    %th{:colspan => 2}
      Ventas
      %br
      sin Boleta
    %th
      Total ventas
      %br
      con Boleta

    %tr
      %td
      %td
      %td
      %th
        Afectas
        %br
        incluido IVA

      %th Exentas
      %th
        Afectas
        %br
        incluido IVA

  - total_con_boleta_iva = 0
  - total_sin_boleta_iva = 0
  - total_exentas = 0
  - @ventas.each do |key, value|
    %tr
      %td= key
      -boleta = []
      - con_boleta_iva = 0
      - sin_boleta_iva = 0
      - value.each do |venta|
        - boleta << venta.numero_boleta unless venta.numero_boleta.nil?
        - con_boleta_iva += venta.total_venta if venta.numero_boleta
        - sin_boleta_iva += venta.total_venta if venta.total_venta <= 180 # con evasión de impuestos
        -# sin_boleta_iva += venta.total_venta unless venta.numero_boleta # sin evasión de impuestos
      - total_con_boleta_iva += con_boleta_iva
      - total_sin_boleta_iva += sin_boleta_iva
      %td= boleta.min.to_i
      %td= boleta.max.to_i
      %td= number_with_delimiter(con_boleta_iva)
      - exentas = 0
      - @mermas[key].each { |merma| exentas += merma.precio_historico * merma.cantidad if merma.tipo_merma == 2 } if @mermas[key]
      - total_exentas += exentas
      %td= exentas
      %td= number_with_delimiter(sin_boleta_iva)
      %td
  %tr
    %td
    %td
    %td
      %strong TOTAL
    %td
      %hr
      %strong= number_to_currency(total_con_boleta_iva)
    %td
      %hr
      %strong= number_to_currency(total_exentas)
    %td
      %hr
      %strong= number_to_currency(total_sin_boleta_iva)
    %td
      %hr
