- title "Balance de cierre de cajas y ventas"

= link_to "Balance de cierre de cajas y ventas", :cierre_venta
|
= link_to "Graficos", :grafico

#opciones
  %table
    %td=date_select "fecha", 'date',{:discard_day => true, :discard_year => true, :prompt => true}, :onchange => "document.location='/cierre_venta?fecha=' + this.value"
- if @vg.length == 0 || @cg.length == 0
  %p.empty_table No existen ventas o cierres de cajas suficientes para realizar el balance.
- else
  %table.main_table
    %th Dia
    %th Total Venta
    %th Total Cierre
    %th Saldo
    -@vg.each do |key,value|
      - @total_c = 0
      %tr
        %td= key
        -@total_v = Venta.sum(:total_venta, :conditions => ["extract(day from created_at) = ?", key ] )
        %td= number_to_currency @total_v
        -@cg.each do |k,v|
          -if key == k
            -@total_c = CierreCaja.sum(:total, :conditions => ["extract(day from created_at) = ?", k ] )
        - if @total_c == 0
          %td Sin cierre
        -else
          %td= number_to_currency @total_c
        - @balance = @total_c - @total_v
        - if @balance > 0 
          %td{:style => "color:blue"}= number_to_currency (@balance)
        - elsif @balance < 0
          %td{:style => "color:red"}= number_to_currency (@balance)
        - elsif @balance == 0
          %td Sin variaci√≥n
